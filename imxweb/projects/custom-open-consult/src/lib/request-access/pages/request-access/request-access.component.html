<div class="scrollable-container">
<form #form="ngForm" (ngSubmit)="handleSubmit()" class="container mt-4">

  <!-- Select de Sistemas -->
  <div class="mb-4">
    <label for="sistema" class="form-label fw-bold">Selecione um sistema:</label>
    <select id="sistema" required class="form-select" [(ngModel)]="selectedSystemUid" name="sistema" (change)="onSystemChange()">
      <option *ngFor="let key of productKeys" [value]="products[key].uid">
        {{ products[key].display }}
      </option>
    </select>
  </div>

  <!-- Seletor de Usuários (somente para admin ou segurança) -->
  <div *ngIf="showUserSelect" class="mb-4">
   <label for="usuario" class="form-label fw-bold">Selecione um usuário:</label>
   <select id="usuario" class="form-select" [(ngModel)]="selectedUserUid" name="usuario">
     <option *ngFor="let user of list_users" [value]="user.uid">
       {{ user.display }}
     </option>
   </select>
  </div>


  <!-- Tabela de Acessos -->
  <div class="mb-3">
    <h5 class="fw-bold">Acessos</h5>
    <table class="table table-bordered table-hover">
      <thead class="table-light">
        <tr>
          <th></th>
          <th>Nome</th>
          <th>Sistema</th>
          <th>Descrição</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let access of paginatedAvailableAccesses()">
          <td><input type="checkbox" [(ngModel)]="access.selected" name="checkbox_{{ access.uid }}"></td>
          <td>{{ access.display }}</td>
          <td>{{ selectedSystemDisplay }}</td>
          <td>{{ access.desc }}</td>
        </tr>
      </tbody>
    </table>
    <!-- Botões de paginação da tabela de Acessos -->
    <div class="d-flex justify-content-center gap-2">
      <button type="button" class="btn btn-outline-primary" (click)="prevPage('available')" [disabled]="availablePage === 1">&lt;</button>
      <span>Página {{ availablePage }}</span>
      <button type="button" class="btn btn-outline-primary" (click)="nextPage('available')" [disabled]="availablePage >= availableTotalPages()">&gt;</button>
    </div>
  </div>

  <!-- Botões entre tabelas -->
  <div class="d-flex justify-content-center mb-3 gap-3">
    <button type="button" class="btn btn-primary" (click)="adicionar()">Adicionar →</button>
    <button type="button" class="btn btn-secondary" (click)="cancelar()">← Cancelar</button>
  </div>

  <!-- Tabela de Acessos Selecionados -->
  <div class="mb-3">
    <h5 class="fw-bold">Acessos Selecionados</h5>
    <table class="table table-bordered table-hover">
      <thead class="table-light">
        <tr>
          <th></th>
          <th>Nome</th>
          <th>Sistema</th>
          <th>Descrição</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let access of paginatedSelectedAccesses()">
          <td><input type="checkbox" [(ngModel)]="access.selected" name="selectedCheckbox_{{ access.uid }}"></td>
          <td>{{ access.display }}</td>
          <td>{{ selectedSystemDisplay }}</td>
          <td>{{ access.desc }}</td>
        </tr>
      </tbody>
    </table>
    <!-- Botões de paginação da tabela de Acessos Selecionados -->
    <div class="d-flex justify-content-center gap-2">
      <button type="button" class="btn btn-outline-primary" (click)="prevPage('selected')" [disabled]="selectedPage === 1">&lt;</button>
      <span>Página {{ selectedPage }}</span>
      <button type="button" class="btn btn-outline-primary" (click)="nextPage('selected')" [disabled]="selectedPage >= selectedTotalPages()">&gt;</button>
    </div>
  </div>

  <!-- Campos de Data -->
  <div class="row mb-4">
    <div class="col-md-6">
      <label for="dataInicio" class="form-label fw-bold">Data de Início:</label>
      <input type="date" id="dataInicio" name="dataInicio" class="form-control" [(ngModel)]="startDate" required>
    </div>
    <div class="col-md-6">
      <label for="dataFim" class="form-label fw-bold">Data de Fim:</label>
      <input type="date" id="dataFim" name="dataFim" class="form-control" [(ngModel)]="endDate" required>
    </div>
  </div>


  <!-- Justificativa -->
  <div class="mb-4">
    <label for="justificativa" class="form-label fw-bold">Justificativa:</label>
    <textarea id="justificativa" name="justificativa" class="form-control" required [(ngModel)]="justificativa" rows="4"></textarea>
  </div>

  <!-- Submit -->
  <div class="text-end">
    <button type="submit" class="btn btn-success">Enviar</button>
  </div>

</form>
</div>
